<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">

    <!-- Security Headers for Admin Panel -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://cdn.jsdelivr.net;
        style-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com;
        img-src 'self' data:;
        connect-src 'self';
        object-src 'none';
        base-uri 'self';
        form-action 'self';
    ">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta name="referrer" content="no-referrer">

    <!-- Prevent caching of admin page -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <title>Admin Dashboard - PrivacyPolicyGen</title>

    <!-- Chart.js with SRI -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"
            integrity="sha256-+8CGmDcQkFLQAgvPaIBJrqpnS5wwfhkpKpzOLlHjLvQ="
            crossorigin="anonymous"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .stat-card { transition: transform 0.2s, box-shadow 0.2s; }
        .stat-card:hover { transform: translateY(-2px); box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
        .login-container { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); }
        .dashboard-hidden { display: none; }
        .chart-container { position: relative; height: 300px; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                    </svg>
                </div>
                <h1 class="text-2xl font-bold text-gray-900">PrivacyPolicyGen Admin</h1>
                <p class="text-gray-600 mt-2">Analytics Dashboard</p>
            </div>
            <form id="loginForm" class="space-y-4">
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" id="password" required
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        placeholder="Enter admin password">
                </div>
                <div id="loginError" class="text-red-500 text-sm hidden">Incorrect password. Please try again.</div>
                <button type="submit" class="w-full bg-blue-500 text-white py-3 rounded-lg font-semibold hover:bg-blue-600 transition">
                    Access Dashboard
                </button>
            </form>
            <p class="text-center text-gray-400 text-xs mt-6">Default password: admin123 (change it!)</p>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="dashboard-hidden">
        <header class="bg-white border-b border-gray-200 sticky top-0 z-10">
            <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-900">PrivacyPolicyGen Analytics</h1>
                        <p class="text-sm text-gray-500" id="lastUpdated">Last updated: --</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <select id="dateRange" class="px-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500">
                        <option value="7">Last 7 days</option>
                        <option value="30" selected>Last 30 days</option>
                        <option value="90">Last 90 days</option>
                        <option value="365">Last year</option>
                    </select>
                    <button onclick="refreshData()" class="px-4 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition text-sm font-medium">Refresh</button>
                    <button onclick="logout()" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition text-sm font-medium">Logout</button>
                </div>
            </div>
        </header>

        <main class="max-w-7xl mx-auto px-4 py-8">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="stat-card bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                    <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mb-4">
                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                    </div>
                    <p class="text-3xl font-bold text-gray-900" id="totalVisits">0</p>
                    <p class="text-gray-500 text-sm">Total Page Views</p>
                </div>
                <div class="stat-card bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                    <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mb-4">
                        <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                    </div>
                    <p class="text-3xl font-bold text-gray-900" id="uniqueVisitors">0</p>
                    <p class="text-gray-500 text-sm">Unique Visitors</p>
                </div>
                <div class="stat-card bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                    <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mb-4">
                        <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    </div>
                    <p class="text-3xl font-bold text-gray-900" id="avgTime">0s</p>
                    <p class="text-gray-500 text-sm">Avg. Time on Page</p>
                </div>
                <div class="stat-card bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                    <div class="w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center mb-4">
                        <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                    </div>
                    <p class="text-3xl font-bold text-gray-900" id="totalEvents">0</p>
                    <p class="text-gray-500 text-sm">Total Actions</p>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Page Views Over Time</h3>
                    <div class="chart-container"><canvas id="pageViewsChart"></canvas></div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Device Breakdown</h3>
                    <div class="chart-container"><canvas id="deviceChart"></canvas></div>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Time on Page Distribution</h3>
                    <div class="chart-container"><canvas id="timeChart"></canvas></div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Top Actions</h3>
                    <div id="topActions" class="space-y-3 max-h-72 overflow-y-auto"><p class="text-gray-500 text-center py-8">No actions tracked yet</p></div>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Conversion Funnel</h3>
                    <div id="funnelChart" class="space-y-2"><p class="text-gray-500 text-center py-8">Track funnel steps with category: "funnel"</p></div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Browser Distribution</h3>
                    <div class="chart-container"><canvas id="browserChart"></canvas></div>
                </div>
            </div>

            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Export Data</h3>
                <div class="flex flex-wrap gap-3">
                    <button onclick="exportData('all')" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition text-sm font-medium">Export Summary (CSV)</button>
                    <button onclick="exportData('pageviews')" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition text-sm font-medium">Export Page Views</button>
                    <button onclick="exportData('events')" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition text-sm font-medium">Export Events</button>
                    <button onclick="exportData('sessions')" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition text-sm font-medium">Export Sessions</button>
                    <button onclick="exportData('timeonpage')" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition text-sm font-medium">Export Time Data</button>
                    <button onclick="clearAllData()" class="px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition text-sm font-medium ml-auto">Clear All Data</button>
                </div>
            </div>

            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100 mt-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Settings</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Change Password</label>
                        <div class="flex gap-3">
                            <input type="password" id="newPassword" placeholder="New password" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <button onclick="changePassword()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition text-sm font-medium">Update</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="analytics.js"></script>
    <script>
        // ==========================================
        // Security Configuration
        // ==========================================
        const ADMIN_PASSWORD_KEY = 'privacypolicygen_admin_password';
        const ADMIN_LOCKOUT_KEY = 'privacypolicygen_admin_lockout';
        const ADMIN_ATTEMPTS_KEY = 'privacypolicygen_admin_attempts';
        const DEFAULT_PASSWORD = 'admin123'; // IMPORTANT: Change this immediately after first login!
        const PRIMARY_COLOR = '#3b82f6';

        // Rate limiting configuration
        const MAX_LOGIN_ATTEMPTS = 5;
        const LOCKOUT_DURATION_MS = 15 * 60 * 1000; // 15 minutes
        const MIN_PASSWORD_LENGTH = 8;

        let pageViewsChart = null, deviceChart = null, timeChart = null, browserChart = null;

        // ==========================================
        // Authentication Security Functions
        // ==========================================

        /**
         * Check if account is currently locked out
         */
        function isLockedOut() {
            const lockoutData = localStorage.getItem(ADMIN_LOCKOUT_KEY);
            if (!lockoutData) return false;

            try {
                const lockout = JSON.parse(lockoutData);
                if (Date.now() < lockout.until) {
                    return true;
                } else {
                    // Lockout expired, clear it
                    localStorage.removeItem(ADMIN_LOCKOUT_KEY);
                    localStorage.removeItem(ADMIN_ATTEMPTS_KEY);
                    return false;
                }
            } catch (e) {
                return false;
            }
        }

        /**
         * Get remaining lockout time in minutes
         */
        function getLockoutRemaining() {
            const lockoutData = localStorage.getItem(ADMIN_LOCKOUT_KEY);
            if (!lockoutData) return 0;

            try {
                const lockout = JSON.parse(lockoutData);
                const remaining = Math.ceil((lockout.until - Date.now()) / 60000);
                return Math.max(0, remaining);
            } catch (e) {
                return 0;
            }
        }

        /**
         * Record a failed login attempt
         */
        function recordFailedAttempt() {
            let attempts = parseInt(localStorage.getItem(ADMIN_ATTEMPTS_KEY) || '0');
            attempts++;
            localStorage.setItem(ADMIN_ATTEMPTS_KEY, attempts.toString());

            if (attempts >= MAX_LOGIN_ATTEMPTS) {
                // Lock the account
                localStorage.setItem(ADMIN_LOCKOUT_KEY, JSON.stringify({
                    until: Date.now() + LOCKOUT_DURATION_MS,
                    attempts: attempts
                }));
                return true; // Account is now locked
            }
            return false;
        }

        /**
         * Clear login attempts on successful login
         */
        function clearLoginAttempts() {
            localStorage.removeItem(ADMIN_ATTEMPTS_KEY);
            localStorage.removeItem(ADMIN_LOCKOUT_KEY);
        }

        /**
         * Get number of remaining attempts
         */
        function getRemainingAttempts() {
            const attempts = parseInt(localStorage.getItem(ADMIN_ATTEMPTS_KEY) || '0');
            return Math.max(0, MAX_LOGIN_ATTEMPTS - attempts);
        }

        /**
         * Simple password strength check
         */
        function isStrongPassword(password) {
            if (password.length < MIN_PASSWORD_LENGTH) return false;
            // Require at least one number and one letter
            if (!/[0-9]/.test(password)) return false;
            if (!/[a-zA-Z]/.test(password)) return false;
            return true;
        }

        /**
         * Escape HTML to prevent XSS in admin panel
         */
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function checkAuth() {
            // Check session with timestamp validation
            const sessionData = sessionStorage.getItem('admin_logged_in');
            if (sessionData) {
                try {
                    const session = JSON.parse(sessionData);
                    // Session expires after 4 hours
                    if (session.timestamp && (Date.now() - session.timestamp) < 4 * 60 * 60 * 1000) {
                        showDashboard();
                        return;
                    }
                } catch (e) {
                    // Old format or invalid, require re-login
                }
            }
            sessionStorage.removeItem('admin_logged_in');
        }

        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const errorEl = document.getElementById('loginError');

            // Check lockout first
            if (isLockedOut()) {
                errorEl.textContent = `Account locked. Try again in ${getLockoutRemaining()} minutes.`;
                errorEl.classList.remove('hidden');
                return;
            }

            const password = document.getElementById('password').value;
            const storedPassword = localStorage.getItem(ADMIN_PASSWORD_KEY) || DEFAULT_PASSWORD;

            if (password === storedPassword) {
                // Store session with timestamp for expiration
                sessionStorage.setItem('admin_logged_in', JSON.stringify({
                    timestamp: Date.now(),
                    valid: true
                }));
                clearLoginAttempts();
                showDashboard();
                errorEl.classList.add('hidden');

                // Warn if still using default password
                if (storedPassword === DEFAULT_PASSWORD) {
                    setTimeout(() => {
                        alert('SECURITY WARNING: You are using the default password. Please change it immediately in Settings.');
                    }, 500);
                }
            } else {
                const isLocked = recordFailedAttempt();
                if (isLocked) {
                    errorEl.textContent = `Too many failed attempts. Account locked for ${Math.ceil(LOCKOUT_DURATION_MS / 60000)} minutes.`;
                } else {
                    const remaining = getRemainingAttempts();
                    errorEl.textContent = `Incorrect password. ${remaining} attempt${remaining !== 1 ? 's' : ''} remaining.`;
                }
                errorEl.classList.remove('hidden');
            }
        });

        function showDashboard() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('dashboard-hidden');
            refreshData();
        }

        function logout() { sessionStorage.removeItem('admin_logged_in'); location.reload(); }

        function refreshData() {
            const days = parseInt(document.getElementById('dateRange').value);
            const report = Analytics.getReport({ days });
            document.getElementById('totalVisits').textContent = report.summary.totalPageViews.toLocaleString();
            document.getElementById('uniqueVisitors').textContent = report.summary.uniqueVisitors.toLocaleString();
            document.getElementById('avgTime').textContent = report.summary.avgTimeFormatted;
            document.getElementById('totalEvents').textContent = report.summary.totalEvents.toLocaleString();
            document.getElementById('lastUpdated').textContent = 'Last updated: ' + new Date().toLocaleTimeString();
            updatePageViewsChart(report.pageViewsByDay);
            updateDeviceChart(report.deviceBreakdown);
            updateTimeChart(report.timeDistribution);
            updateBrowserChart(report.browserBreakdown);
            updateTopActions(report.topActions);
            updateFunnel(report.funnelSteps);
        }

        function updatePageViewsChart(data) {
            const ctx = document.getElementById('pageViewsChart').getContext('2d');
            const labels = Object.keys(data).sort();
            if (pageViewsChart) pageViewsChart.destroy();
            pageViewsChart = new Chart(ctx, {
                type: 'line',
                data: { labels: labels.map(d => new Date(d).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })), datasets: [{ label: 'Page Views', data: labels.map(l => data[l]), borderColor: PRIMARY_COLOR, backgroundColor: 'rgba(59, 130, 246, 0.1)', fill: true, tension: 0.4 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
            });
        }

        function updateDeviceChart(data) {
            const ctx = document.getElementById('deviceChart').getContext('2d');
            if (deviceChart) deviceChart.destroy();
            deviceChart = new Chart(ctx, { type: 'doughnut', data: { labels: Object.keys(data), datasets: [{ data: Object.values(data), backgroundColor: ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'] }] }, options: { responsive: true, maintainAspectRatio: false } });
        }

        function updateTimeChart(data) {
            const ctx = document.getElementById('timeChart').getContext('2d');
            if (timeChart) timeChart.destroy();
            timeChart = new Chart(ctx, { type: 'bar', data: { labels: Object.keys(data), datasets: [{ label: 'Sessions', data: Object.values(data), backgroundColor: PRIMARY_COLOR }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } } });
        }

        function updateBrowserChart(data) {
            const ctx = document.getElementById('browserChart').getContext('2d');
            if (browserChart) browserChart.destroy();
            browserChart = new Chart(ctx, { type: 'pie', data: { labels: Object.keys(data), datasets: [{ data: Object.values(data), backgroundColor: ['#ef4444', '#f59e0b', '#10b981', '#3b82f6', '#8b5cf6', '#ec4899'] }] }, options: { responsive: true, maintainAspectRatio: false } });
        }

        function updateTopActions(actions) {
            const container = document.getElementById('topActions');
            if (actions.length === 0) { container.innerHTML = '<p class="text-gray-500 text-center py-8">No actions tracked yet</p>'; return; }
            const maxCount = actions[0][1];
            // Escape action names to prevent XSS
            container.innerHTML = actions.map(([action, count]) => {
                const safeAction = escapeHtml(action);
                const safeCount = parseInt(count) || 0;
                const percentage = Math.round((safeCount / maxCount) * 100);
                return `<div class="flex items-center gap-3"><div class="flex-1"><div class="flex justify-between text-sm mb-1"><span class="font-medium text-gray-700">${safeAction}</span><span class="text-gray-500">${safeCount}</span></div><div class="w-full bg-gray-100 rounded-full h-2"><div class="bg-blue-500 h-2 rounded-full" style="width: ${percentage}%"></div></div></div></div>`;
            }).join('');
        }

        function updateFunnel(data) {
            const container = document.getElementById('funnelChart');
            const steps = Object.entries(data);
            if (steps.length === 0) { container.innerHTML = '<p class="text-gray-500 text-center py-8">Track funnel steps with category: "funnel"</p>'; return; }
            const maxCount = Math.max(...steps.map(s => parseInt(s[1]) || 0));
            // Escape step names to prevent XSS
            container.innerHTML = steps.map(([step, count], index) => {
                const safeStep = escapeHtml(step);
                const safeCount = parseInt(count) || 0;
                const percentage = Math.round((safeCount / maxCount) * 100);
                const prevCount = index > 0 ? (parseInt(steps[index - 1][1]) || 0) : 0;
                const dropoff = index > 0 && prevCount > 0 ? Math.round((1 - safeCount / prevCount) * 100) : 0;
                return `<div class="relative"><div class="flex items-center justify-between mb-1"><span class="font-medium text-gray-700">${safeStep}</span><span class="text-gray-500">${safeCount} ${dropoff > 0 ? `<span class="text-red-500">(-${dropoff}%)</span>` : ''}</span></div><div class="w-full bg-gray-100 rounded h-8 flex items-center"><div class="bg-gradient-to-r from-blue-500 to-blue-400 h-8 rounded flex items-center justify-center text-white text-sm font-medium" style="width: ${percentage}%">${percentage}%</div></div></div>`;
            }).join('');
        }

        function exportData(type) { Analytics.exportCSV(type); }

        function clearAllData() {
            if (confirm('Are you sure you want to clear ALL analytics data? This cannot be undone.')) {
                Analytics.clearData();
                refreshData();
                alert('All analytics data has been cleared.');
            }
        }

        function changePassword() {
            const newPassword = document.getElementById('newPassword').value;

            // Validate password strength
            if (newPassword.length < MIN_PASSWORD_LENGTH) {
                alert(`Password must be at least ${MIN_PASSWORD_LENGTH} characters.`);
                return;
            }

            if (!isStrongPassword(newPassword)) {
                alert('Password must contain at least one letter and one number.');
                return;
            }

            // Check for common weak passwords
            const weakPasswords = ['password', 'admin123', '12345678', 'password1', 'qwerty123'];
            if (weakPasswords.includes(newPassword.toLowerCase())) {
                alert('This password is too common. Please choose a stronger password.');
                return;
            }

            localStorage.setItem(ADMIN_PASSWORD_KEY, newPassword);
            document.getElementById('newPassword').value = '';
            alert('Password updated successfully! Please remember your new password.');
        }

        document.getElementById('dateRange').addEventListener('change', refreshData);
        checkAuth();
    </script>
</body>
</html>
